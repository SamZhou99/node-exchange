<!DOCTYPE html>
<html lang="{{lang.list[defLang].lang}}">

<head>
    {{include '../_header.html'}}
    <link href="/default/js/dropzone/dropzone.css" rel="stylesheet" type="text/css" />
    <style>
        .bg01 {
            margin-top: 50px;
            margin-bottom: 50px;
            padding: 20px;
            background-color: #202b3f;
        }

        .p0 {
            padding: 0px;
        }

        .profilePicture {
            width: 60px;
            border-radius: 50%;
        }

        .dropzone {
            border-radius: 5px;
            border: 1px solid #000;
        }

        .dz-message {
            color: #000;
        }

        .container-t {
            position: absolute;
            background-color: #ffecf700;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            display: none;
            z-index: 2000;
        }

        .item-t {
            text-align: center;
            border-radius: 10px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 300px;
            height: 60px;
            background-color: #000000ad;
            padding-top: 18px;
        }
    </style>
</head>

<body>
    {{include '../_menu.html'}}

    <div id="app" class="container-fluid main-content p0">
        {{include './_user_info.html'}}



        <div class="container">
            <div class="row">
                <div class="col-md-3 col-sm-12">
                    {{include './_menu.html'}}
                </div>
                <div class="col-md-9 col-sm-12">

                    <div v-if="status==1">
                        <h1>等待审核</h1>
                    </div>


                    <div v-if="status==0 || status==2">

                        <div v-if="status==2" class="form-group">
                            <h1>{[failed_reason]}</h1>
                        </div>

                        <div class="form-row">
                            <div class="form-group col-md-6">
                                <label for="country">Country</label>
                                <input v-model="form.country" type="text" class="form-control" id="country" required>
                            </div>
                            <div class="form-group col-md-6">
                                <label for="full_name">Full name / Id card name</label>
                                <input v-model="form.full_name" type="text" class="form-control" id="full_name" required>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group col-md-12">
                                <label for="id_number">Id number</label>
                                <input v-model="form.id_number" type="text" class="form-control" id="id_number" required>
                            </div>
                        </div>


                        <div class="form-row">
                            <div class="form-group col-md-12">
                                <label for="dropzone">Front and back of the Id photo</label>
                                <form action="/api/upload-file" class="dropzone dz-clickable" id="dropzone">
                                    <div class="dz-default dz-message">
                                        <span>Drag and drop the photo here and upload it</span>
                                    </div>
                                </form>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group col-md-12">
                                <button @click="onClickSubmit()" class="btn btn-primary btn-block">Submit information</button>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group col-md-12">
                                <h3>important note ：</h3>
                                <ul>
                                    <li>1. Please upload clear id photo</li>
                                    <li>2. The image can be in JPG, PNG, or JPEG format and the size cannot exceed 1 MB</li>
                                    <li>3. Please pass the standard with your passport photo in hand. The passport information is clear, including the words "{{lang.name}}" and the date of the day </li>
                                    <li>4. If you encounter problems contact customer service {{lang.mail}}</li>
                                </ul>
                            </div>
                        </div>

                    </div>


                </div>
            </div>
        </div>




        <div class="container-t">
            <div class="item-t"></div>
        </div>

    </div>

    {{include '../_footer.html'}}
    <script src="/default/js/dropzone/dropzone.js"></script>


    <script>
        let app = new Vue({
            delimiters: ["{[", "]}"],
            el: '#app',
            data: {
                loading: false,
                status: '',
                failed_reason: '',
                form: {
                    country: '',
                    full_name: '',
                    id_number: '',
                }
            },
            methods: {
                onClickSubmit() {
                    console.log(this.form)
                    if (!this.form.country || !this.form.full_name || !this.form.id_number) {
                        this.tip('Please fill out the form completely!')
                        return
                    }
                    this.post('/api/update-authentication', this.form, (data) => {
                        if (data.flag != 'ok') {
                            this.tip(data.flag)
                            return
                        }
                        if (data.data.status == 1) {
                            console.log('等待审核')
                        }
                    })
                },
                tip(text, callback) {
                    $('.container-t').show()
                    $('.item-t').text(text)
                    setTimeout(function () {
                        $('.container-t').hide()
                        if (callback) {
                            callback()
                        }
                    }, 2000)
                },
                post(url, params, callback) {
                    this.loading = true;
                    $.post(url, params, res => {
                        this.loading = false;
                        callback(res);
                    })
                },
                get(url, params, callback) {
                    this.loading = true;
                    $.ajax({
                        'url': url,
                        'type': 'GET',
                        'dataType': 'json',
                        'data': params,
                        'success': res => {
                            this.loading = false;
                            callback(res);
                        },
                        'error': err => {
                            this.loading = false;
                            console.log(err);
                            alert(err.statusText);
                        }
                    })
                },
                init() {

                    $('body').bind('dz-success-event', (files, responseText, e) => {
                        if (e) {
                            alert(e)
                            return
                        }
                        let flag = responseText.responseText.flag
                        if (flag != 'ok') {
                            alert(flag)
                            return
                        }
                        this.results = responseText.responseText.data
                    })


             
                    this.get('/api/authentication', {}, (data) => {
                        if (data.flag != 'ok') {
                            console.log(data.falg)
                            return
                        }
                        this.status = data.data.status
                        this.failed_reason = data.data.failed_reason
                    })
                }
            },
            mounted() {
                this.init();
            }
        });
    </script>


</body>

</html>